//SCRIPT

const coordinates = [
    [7.064032851953117, 125.6098222732544],
    [7.064968731233319, 125.6101253755408],
    [7.065862774274147, 125.6103614085862],
    [7.066522662076037, 125.6105545265324],
    [7.067310268864379, 125.6107476444786],
    [7.067927581354776, 125.6109085761004],
    [7.068354414368896, 125.6110467049707],
    [7.068865292575773, 125.6111969078177],
    [7.069597911001153, 125.6114128255132],
    [7.070257793469214, 125.611627401009],
    [7.070875102021462, 125.6117668750813],
    [7.071279545108396, 125.6119063491535],
    [7.071981998049231, 125.6120780095501],
    [7.07248222903758, 125.6121960260728],
    [7.072780238730557, 125.6122818562711],
    [7.073174036958401, 125.6124213303434],
    [7.073482689388708, 125.6124857029921],
    [7.073642337116537, 125.6126895497131],
    [7.073642337116537, 125.6134405639483],
    [7.07372466813342, 125.6142385211991],
    [7.073731861651218, 125.614721332087],
    [7.073773775142803, 125.6154146847333],
    [7.073858920550848, 125.6163373593652],
    [7.073880206900404, 125.6169918146273],
    [7.073933422769986, 125.6177535576373],
    [7.07399728180541, 125.6186118596204],
    [7.074029211319801, 125.6192770436573],
    [7.074067175575262, 125.6199033473739],
    [7.074093783500035, 125.6204934299872],
    [7.074131034592162, 125.6212283510603],
    [7.074157642513258, 125.6216843239888],
    [7.074184250432853, 125.6220705598812],
    [7.074200215183859, 125.6224514313862],
    [7.0742587525995, 125.6231166154231],
    [7.074264074182375, 125.6236208678381],
    [7.074306646843142, 125.6241304846406],
    [7.074338576336147, 125.6245489068574],
    [7.074306646843142, 125.6247849399027],
    [7.07423214468423, 125.6247688467406],
    [7.073982030205626, 125.6245328136952],
    [7.07355630312197, 125.6240500188297],
    [7.073252972335388, 125.6236745117121],
    [7.072922491956908, 125.6232507476862],
    [7.072507407102699, 125.6227518596585],
    [7.072225362052971, 125.6224085388653],
    [7.072001854532722, 125.6221081331712],
    [7.071730452398448, 125.6217540836032],
    [7.071459050104688, 125.6214161271974],
    [7.071246185448967, 125.6211908229268],
    [7.071012034214371, 125.6208957816201],
    [7.070740631498463, 125.6206651129621],
    [7.070469228623082, 125.6204129867546],
    [7.070197825588279, 125.620214504421],
    [7.069772095016343, 125.6200052933127],
    [7.069372972248841, 125.6198121753665],
    [7.069165428273493, 125.6196190574203],
    [7.068697111589437, 125.6190879828537],
    [7.068244771374478, 125.6185032646278],
    [7.067845647287668, 125.618084842411],
    [7.067467809501167, 125.6175644968338],
    [7.067068684743312, 125.6170870663557],
    [7.066669559640773, 125.6166310934272],
    [7.066360902658455, 125.6162287643726],
    [7.066009672048572, 125.6158103421558],
    [7.065687648228022, 125.6154026071109],
    [7.065139446768364, 125.6147696061817],
    [7.064793536922363, 125.6143404551901],
    [7.064431661729536, 125.6139113041986],
    [7.064261367423144, 125.6137020930902],
    [7.064053821152416, 125.6133909586214],
    [7.063899491813779, 125.6129403500802],
    [7.06377134140885, 125.6125862897591],
    [7.063617011975954, 125.6121839607046],
    [7.06339350029213, 125.611754809713],
    [7.063239170733106, 125.6115724205416],
    [7.063052910851907, 125.6112612860728],
    [7.063010337154253, 125.6111486339375],
    [7.063228527313343, 125.6108482282434],
    [7.063462682491508, 125.6105531869367],
    [7.063648942207662, 125.610311789504],
    [7.064026783115649, 125.6098289946385]
];


const coordinates2 = [
    [7.073613468294189, 125.60901226754606],
    [7.074039195325124, 125.60862603165367],
    [7.0744862082851325, 125.60823979576128],
    [7.074975793411408, 125.60787501741848],
    [7.075444091741986, 125.60746732397652],
    [7.07584853082698, 125.60712400318329],
    [7.076338114508343, 125.60675922484046],
    [7.0767638390265635, 125.60641590404722],
    [7.077104418358373, 125.60615841345229],
    [7.0775088559884685, 125.60581509265906],
    [7.077936333365436, 125.60612352551136],
    [7.078244982611398, 125.60646684630458],
    [7.078511059381829, 125.60681016709782],
    [7.078787779060322, 125.60718567421544],
    [7.079043212462426, 125.6074968086843],
    [7.0792560735227985, 125.60775429927924],
    [7.079447648393163, 125.60801178987414],
    [7.0797243675099075, 125.6083443818926],
    [7.079990443427174, 125.60867697391109],
    [7.080320377351463, 125.60907393857826],
    [7.080543880843514, 125.60935288672276],
    [7.080788670258176, 125.60962110609248],
    [7.081012173523302, 125.60988932546219],
    [7.0812143906698815, 125.61014681605712],
    [7.081469822728315, 125.61037212032768],
    [7.081799755594395, 125.61081200009401],
    [7.0819700434329125, 125.61104803313935],
    [7.082140331208569, 125.61130552373429],
    [7.082342547860483, 125.61153082800485],
    [7.0825234784739, 125.61175613227542],
    [7.082683123073831, 125.61198143654597],
    [7.082810838713958, 125.61224965591572],
    [7.08283212465055, 125.61252860406022],
    [7.082299975941142, 125.61258224793417],
    [7.0819700434329125, 125.61260370548375],
    [7.0816507536840865, 125.61264662058291],
    [7.08136339272114, 125.61268953568205],
    [7.081129246618979, 125.61271099323164],
    [7.080958958470002, 125.61273245078121],
    [7.080735455179076, 125.61277536588037],
    [7.080362949453534, 125.6128397385291],
    [7.080054301624508, 125.61287192485347],
    [7.07970308142991, 125.61290411117784],
    [7.079415719253633, 125.61295775505178],
    [7.079160286057769, 125.61300067015091],
    [7.078872923543411, 125.61305431402486],
    [7.078628133112218, 125.61309722912404],
    [7.078393985621746, 125.61310795789882],
    [7.078085336475475, 125.61314014422317],
    [7.077712828610208, 125.61322597442148],
    [7.077393535914929, 125.61326888952064],
    [7.077127458500118, 125.61327961829542],
    [7.07686138093189, 125.61330107584502],
    [7.076680448097873, 125.61332253339458],
    [7.076552730760564, 125.61304358525008],
    [7.07641437027193, 125.61278609465515],
    [7.076286652860985, 125.61257151915939],
    [7.076222794142269, 125.61241058753755],
    [7.07600993168272, 125.61214236816785],
    [7.075754496601716, 125.6118526912485],
    [7.075616135873791, 125.6116595733023],
    [7.075467131966589, 125.61142354025698],
    [7.075413916273795, 125.61119823598641],
    [7.07540327313448, 125.61080127131922],
    [7.075339414293554, 125.61049013685036],
    [7.075243626015587, 125.61022191748063],
    [7.075030763104527, 125.60994296933613],
    [7.07464760961723, 125.60956746221854],
    [7.0743496011295175, 125.60935288672276],
    [7.0739983765934245, 125.6092134126505],
    [7.073583292706358, 125.60905248102868]
];

const sendCoordinates = async (latitude1, longitude1, latitude2, longitude2) => {
    const url = `https://api.thingspeak.com/update?api_key=6RA7HGL30BKCD1CQ&field1=${latitude1}&field2=${longitude1}&field3=${latitude2}&field4=${longitude2}`;

    try {
        // Send the coordinates to ThingSpeak
        const response = await fetch(url);
        const data = await response.text();
        console.log(`Sent: lat1 = ${latitude1}, lon1 = ${longitude1}, lat2 = ${latitude2}, lon2 = ${longitude2} - Response: ${data}`);

    } catch (error) {
        console.error(`Error sending lat1 = ${latitude1}, lon1 = ${longitude1}, lat2 = ${latitude2}, lon2 = ${longitude2}:`, error);
    }
};

const sendCoordinatesWithDelay = async () => {
    while (true) { // Infinite loop to keep sending coordinates
        for (let i = 0; i < coordinates.length; i++) {
            const [latitude1, longitude1] = coordinates[i];
            const [latitude2, longitude2] = coordinates2[i % coordinates2.length]; // Loop through coordinates2

            await sendCoordinates(latitude1, longitude1, latitude2, longitude2);

            if (i < coordinates.length - 1) {
                console.log('Waiting for 15 seconds...');
                await new Promise(resolve => setTimeout(resolve, 15000)); // 15 seconds delay
            }
        }
        console.log("Looping back to the first coordinate...");
    }
};

// Start sending coordinates

const busDataScript = async () => {
    await sendCoordinatesWithDelay();
    console.log("All coordinates sent to ThingSpeak with a 15-second delay!");
};



module.exports = {
    busDataScript
}